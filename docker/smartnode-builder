# This image is used to build the Rocket Pool Smartnode and related artifacts

FROM golang:1.23-bookworm

# Install build tools
RUN dpkg --add-architecture arm64
RUN apt update && apt install -y \
	build-essential \
	gcc-aarch64-linux-gnu \
	libc6-dev-arm64-cross\
	g++-aarch64-linux-gnu \
	wget

# Cache go dependencies
COPY ./go.work /src/go.work
COPY ./go.work.sum /src/go.work.sum
COPY ./addons/go.mod /src/addons/go.mod
COPY ./rocketpool/go.mod /src/rocketpool/go.mod
COPY ./rocketpool-cli/go.mod /src/rocketpool-cli/go.mod
COPY ./shared/go.mod /src/shared/go.mod
COPY ./treegen/go.mod /src/treegen/go.mod
WORKDIR /src
RUN go mod download -x
WORKDIR /
RUN rm -rf /src
