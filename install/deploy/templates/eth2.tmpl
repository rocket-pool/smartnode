# Autogenerated - DO NOT MODIFY THIS FILE DIRECTLY 
# If you want to overwrite some of these values with your own customizations,
# please add them to `override/eth2.yml`.
# 
# See https://docs.docker.com/compose/extends/#adding-and-overriding-configuration
# for more information on overriding specific parameters of docker-compose files.

services:
  {{.BeaconNodeContainerName}}:
    image: {{.GetBnContainerTag}}
    user: root
    container_name: {{.ProjectName}}_{{.BeaconNodeContainerName}}
    restart: unless-stopped
    stop_grace_period: 3m
    {{- $p2p := (or .LocalBeaconClient.P2pPort.String "9001")}}
    ports:
      - "{{$p2p}}:{{$p2p}}/udp"
      - "{{$p2p}}:{{$p2p}}/tcp"
      {{- if eq .LocalBeaconClient.BeaconNode.String "lighthouse"}}
      - "{{.LocalBeaconClient.Lighthouse.P2pQuicPort}}:{{.LocalBeaconClient.Lighthouse.P2pQuicPort}}/udp"
      {{- end}}
      {{- range $entry := .GetBnOpenPorts}}
      - "{{$entry}}"
      {{- end}}
    volumes:
      - {{.BeaconNodeDataVolume}}:/ethclient
      - /usr/share/rocketpool/scripts:/usr/share/rocketpool/scripts:ro
      - /var/lib/rocketpool/data/{{.ProjectName}}:/secrets:ro
    networks:
      - net
    environment:
      - NETWORK={{.Network}}
      - CLIENT={{.LocalBeaconClient.BeaconNode}}
      - EC_HTTP_ENDPOINT={{.GetEcHttpEndpoint}}
      - EC_WS_ENDPOINT={{.GetEcWsEndpoint}}
      - EC_ENGINE_ENDPOINT=http://{{.GetExecutionHostname}}:{{.LocalExecutionClient.EnginePort}}
      - EC_ENGINE_WS_ENDPOINT=ws://{{.GetExecutionHostname}}:{{.LocalExecutionClient.EnginePort}}
      - BN_P2P_PORT={{$p2p}}
      - BN_API_PORT={{.LocalBeaconClient.HttpPort}}
      - BN_MAX_PEERS={{.GetBnMaxPeers}}
      - ENABLE_METRICS={{.Metrics.EnableMetrics}}
      - BN_METRICS_PORT={{.Metrics.BnMetricsPort}}
      - EXTERNAL_IP={{.GetExternalIP}}
      - CHECKPOINT_SYNC_URL={{.LocalBeaconClient.CheckpointSyncProvider}}
      - BN_ADDITIONAL_FLAGS={{.GetBnAdditionalFlags}}
      - ENABLE_BITFLY_NODE_METRICS={{.Metrics.EnableBitflyNodeMetrics}}
      - BITFLY_NODE_METRICS_SECRET={{.Metrics.BitflyNodeMetrics.Secret}}
      - BITFLY_NODE_METRICS_ENDPOINT={{.Metrics.BitflyNodeMetrics.Endpoint}}
      - BITFLY_NODE_METRICS_MACHINE_NAME={{.Metrics.BitflyNodeMetrics.MachineName}}
      - MEV_BOOST_URL={{.MevBoostUrl}}
      - RETH_ADDRESS={{.GetRocketPoolResources.RethAddress.Hex}}
      {{- /* Client-specific values */}}
      {{- if eq .LocalBeaconClient.BeaconNode.String "teku"}}
      - TEKU_JVM_HEAP_SIZE={{.LocalBeaconClient.Teku.JvmHeapSize}}
      - TEKU_ARCHIVE_MODE={{.LocalBeaconClient.Teku.ArchiveMode}}
      {{- else if eq .LocalBeaconClient.BeaconNode.String "prysm"}}
      - BN_RPC_PORT={{.LocalBeaconClient.Prysm.RpcPort}}
      {{- else if eq .LocalBeaconClient.BeaconNode.String "nimbus"}}
      - NIMBUS_PRUNING_MODE={{.LocalBeaconClient.Nimbus.PruningMode}}
      {{- else if eq .LocalBeaconClient.BeaconNode.String "lighthouse"}}
      - BN_P2P_QUIC_PORT={{.LocalBeaconClient.Lighthouse.P2pQuicPort}}
      {{- end}}
    entrypoint: sh
    command: "/usr/share/rocketpool/scripts/{{.GetBnStartScript}}"
    cap_drop:
      - all
    cap_add:
      - dac_override
    security_opt:
      - no-new-privileges
networks:
  net:
volumes:
  {{.BeaconNodeDataVolume}}:
